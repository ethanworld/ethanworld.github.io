<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>参考文献 | 伊森沃德·博客</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/statics/icon.png">
    <meta name="description" content="操作系统/编译原理/软件架构">
    
    <link rel="preload" href="/assets/css/0.styles.7cfabf05.css" as="style"><link rel="preload" href="/assets/js/app.4e225d25.js" as="script"><link rel="preload" href="/assets/js/2.837ff8a6.js" as="script"><link rel="preload" href="/assets/js/28.51d22622.js" as="script"><link rel="prefetch" href="/assets/js/10.150c7950.js"><link rel="prefetch" href="/assets/js/11.fe792822.js"><link rel="prefetch" href="/assets/js/12.acb41d84.js"><link rel="prefetch" href="/assets/js/13.c1bc46f2.js"><link rel="prefetch" href="/assets/js/14.2be8fe3a.js"><link rel="prefetch" href="/assets/js/15.708768b8.js"><link rel="prefetch" href="/assets/js/16.482c6595.js"><link rel="prefetch" href="/assets/js/17.8557a20b.js"><link rel="prefetch" href="/assets/js/18.9b0bb015.js"><link rel="prefetch" href="/assets/js/19.817d4a3f.js"><link rel="prefetch" href="/assets/js/20.18fbc077.js"><link rel="prefetch" href="/assets/js/21.0cffd3ae.js"><link rel="prefetch" href="/assets/js/22.9c76a16e.js"><link rel="prefetch" href="/assets/js/23.95299485.js"><link rel="prefetch" href="/assets/js/24.3d73aaad.js"><link rel="prefetch" href="/assets/js/25.10537653.js"><link rel="prefetch" href="/assets/js/26.8c4b6cb3.js"><link rel="prefetch" href="/assets/js/27.b90202b3.js"><link rel="prefetch" href="/assets/js/29.192c5745.js"><link rel="prefetch" href="/assets/js/3.010af69f.js"><link rel="prefetch" href="/assets/js/30.879eb012.js"><link rel="prefetch" href="/assets/js/31.ba04797f.js"><link rel="prefetch" href="/assets/js/32.efa91b5b.js"><link rel="prefetch" href="/assets/js/33.835b82d8.js"><link rel="prefetch" href="/assets/js/34.6a38e7f6.js"><link rel="prefetch" href="/assets/js/4.9db83892.js"><link rel="prefetch" href="/assets/js/5.241d3732.js"><link rel="prefetch" href="/assets/js/6.6033682a.js"><link rel="prefetch" href="/assets/js/7.ec21328a.js"><link rel="prefetch" href="/assets/js/8.8bf495ff.js"><link rel="prefetch" href="/assets/js/9.cf370094.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7cfabf05.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/statics/logo.png" alt="伊森沃德·博客" class="logo"> <span class="site-name can-hide">伊森沃德·博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/1.生活记录/" class="nav-link">
  生活记录
</a></div><div class="nav-item"><a href="/2.操作系统/" class="nav-link">
  操作系统
</a></div><div class="nav-item"><a href="/3.编译原理/" class="nav-link">
  编译原理
</a></div><div class="nav-item"><a href="/4.通信协议/" class="nav-link">
  通信协议
</a></div><div class="nav-item"><a href="/5.数据结构/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/6.设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/7.工具效率/" class="nav-link">
  工具效率
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/1.生活记录/" class="nav-link">
  生活记录
</a></div><div class="nav-item"><a href="/2.操作系统/" class="nav-link">
  操作系统
</a></div><div class="nav-item"><a href="/3.编译原理/" class="nav-link">
  编译原理
</a></div><div class="nav-item"><a href="/4.通信协议/" class="nav-link">
  通信协议
</a></div><div class="nav-item"><a href="/5.数据结构/" class="nav-link">
  数据结构
</a></div><div class="nav-item"><a href="/6.设计模式/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="/7.工具效率/" class="nav-link">
  工具效率
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/6.%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/6.设计模式/django.html" class="sidebar-link">项目结构</a></li><li><a href="/6.设计模式/flask.html" class="sidebar-link">Flask</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#wsgi" class="sidebar-link">WSGI</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#werkzeug" class="sidebar-link">WerkZeug</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#路由" class="sidebar-link">路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#注册路由" class="sidebar-link">注册路由</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#endpoint" class="sidebar-link">Endpoint</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#静态目录路由" class="sidebar-link">静态目录路由</a></li></ul></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#启动过程" class="sidebar-link">启动过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#时序图" class="sidebar-link">时序图</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#服务器" class="sidebar-link">服务器</a></li></ul></li><li class="sidebar-sub-header"><a href="/6.设计模式/flask.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/6.设计模式/mongodb.html" class="sidebar-link">MongoDB</a></li><li><a href="/6.设计模式/pyqt.html" class="sidebar-link">/6.设计模式/pyqt.html</a></li><li><a href="/6.设计模式/vue.html" class="active sidebar-link">参考文献</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#dep类" class="sidebar-link">Dep类</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#observer类" class="sidebar-link">Observer类</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#statemixin" class="sidebar-link">stateMixin</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#rendermixin" class="sidebar-link">renderMixin</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#lifecyclemixin" class="sidebar-link">lifecycleMixin</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#eventsmixin" class="sidebar-link">eventsMixin</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue.html#initmixin" class="sidebar-link">initMixin</a></li></ul></li><li><a href="/6.设计模式/vue3.html" class="sidebar-link">/6.设计模式/vue3.html</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/vue3.html#依赖管理" class="sidebar-link">依赖管理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/6.设计模式/vue3.html#添加依赖" class="sidebar-link">添加依赖</a></li><li class="sidebar-sub-header"><a href="/6.设计模式/vue3.html#触发依赖" class="sidebar-link">触发依赖</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h1> <ul><li>https://blog.csdn.net/weixin_37517329/article/details/121861019</li></ul> <h1 id="源码目录"><a href="#源码目录" class="header-anchor">#</a> 源码目录</h1> <div class="language- extra-class"><pre class="language-text"><code>src
	- compiler
	- core
		- components
		- global-api
		- instance
		- observer
		- util
		- vdom
		- config.js
		- index.js
	- platforms
	- server
	- sfc
	- shared
	
	
</code></pre></div><h2 id="dep类"><a href="#dep类" class="header-anchor">#</a> <code>Dep</code>类</h2> <ul><li>维护<code>subs</code>订阅数组，数组元素为：<code>Watcher</code></li> <li><code>Dep.target</code>：JS为单线程，同一时间，target指向唯一的<code>Watcher</code></li> <li><code>dep.notfify()</code>方法：遍历<code>dep.subs</code>，调用<code>watch.update()</code></li></ul> <h2 id="observer类"><a href="#observer类" class="header-anchor">#</a> <code>Observer</code>类</h2> <ul><li>对入参value进行封装</li> <li><code>Object.defineProperty(value, '__ob__', observer实例)</code></li> <li>遍历对象：this.walk
<ul><li>defineReactive</li></ul></li></ul> <h1 id="vue调试方法"><a href="#vue调试方法" class="header-anchor">#</a> vue调试方法</h1> <ul><li><p>克隆vue： <code>git clone https://github.com/vuejs/vue</code></p></li> <li><p>安装依赖： <code>npm install</code></p></li> <li><p>安装rollup: <code>npm i -g rollup</code></p></li> <li><p>修改package.json，打包生成sourcemap</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -w -c scripts/config.js --environment TARGET:web-full-dev --sourcemap&quot;</span><span class="token punctuation">,</span>
</code></pre></div></li> <li><p>npm run dev 生成dist文件</p></li> <li><p>在项目根目录新建index.html，引入vue.js</p></li> <li><p>点击调试，新建launch.json,把入口文件配置为index.html</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 使用 IntelliSense 了解相关属性。 </span>
  <span class="token comment">// 悬停以查看现有属性的描述。</span>
  <span class="token comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pwa-chrome&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;request&quot;</span><span class="token operator">:</span> <span class="token string">&quot;launch&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Open index.html&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/Users/zengyuan/Documents/coding/vue/index.html&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>在chrome中打开index.html，并使用vscode调试vue 中src目录下的源码</p></li></ul> <p>参考：https://blog.csdn.net/weixin_42630688/article/details/118930813</p> <h1 id="vue源码"><a href="#vue源码" class="header-anchor">#</a> vue源码</h1> <p>阅读框架的方法：</p> <ul><li>从需求入手，先理解要实现解决什么问题，实现什么功能，才理解框架如何实现的</li> <li>运用UML时序图、交互图、类图等从整体角度展示框架设计思路</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//vue 构造函数</span>
<span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//初始化vue</span>
<span class="token function">stateMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//数据绑定，$watch方法</span>
<span class="token function">eventsMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化事件绑定方法</span>
<span class="token function">lifecycleMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化vue 更新 销毁 函数</span>
<span class="token function">renderMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化vue 需要渲染的函数</span>
</code></pre></div><p><img src="https://cdn.jsdelivr.net/gh/ethanworld/images@main/202204171732291.svg" alt="lifecycle"></p> <h2 id="statemixin"><a href="#statemixin" class="header-anchor">#</a> <code>stateMixin</code></h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//数据绑定，$watch方法</span>
<span class="token keyword">function</span> <span class="token function">stateMixin</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加多一个数组数据或者对象数据</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$set <span class="token operator">=</span> set<span class="token punctuation">;</span>
  <span class="token comment">// 删除一个数组数据或者对象数据</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$<span class="token keyword">delete</span> <span class="token operator">=</span> del<span class="token punctuation">;</span>
  <span class="token keyword">var</span> dataDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//重新定义get 和set方法</span>
  dataDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token comment">//获取data中的数据</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> propsDef <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  propsDef<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_props<span class="token comment">// 获取props 数据</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$data'</span><span class="token punctuation">,</span> dataDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">'$props'</span><span class="token punctuation">,</span> propsDef<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$watch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>expOrFn<span class="token punctuation">,</span> <span class="token comment">//用户手动监听</span>
                                    cb<span class="token punctuation">,</span> <span class="token comment">// 监听 变化之后 回调函数</span>
                                    options <span class="token comment">//参数</span>
                                   <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="rendermixin"><a href="#rendermixin" class="header-anchor">#</a> <code>renderMixin</code></h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">renderMixin</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$nextTick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="lifecyclemixin"><a href="#lifecyclemixin" class="header-anchor">#</a> <code>lifecycleMixin</code></h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 初始化vue 更新 销毁 函数</span>
<span class="token keyword">function</span> <span class="token function">lifecycleMixin</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$forceUpdate</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$destroy</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="eventsmixin"><a href="#eventsmixin" class="header-anchor">#</a> <code>eventsMixin</code></h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">eventsMixin</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$on</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$once</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$off</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$emit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="initmixin"><a href="#initmixin" class="header-anchor">#</a> <code>initMixin</code></h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">initMixin</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 初始化函数</span>
	<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
    <span class="token comment">//合并参数 将两个对象合成一个对象 将父值对象和子值对象合并在一起，并且优先取值子值，如果没有则取子值</span>
    vm<span class="token punctuation">.</span>$options <span class="token operator">=</span> <span class="token function">mergeOptions</span><span class="token punctuation">(</span>
      <span class="token function">resolveConstructorOptions</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//  //解析constructor上的options属性的</span>
      options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    
    vm<span class="token punctuation">.</span>_self <span class="token operator">=</span> vm<span class="token punctuation">;</span>
    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化生命周期 标志</span>
    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//初始化事件</span>
    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化渲染</span>
    <span class="token comment">// 触发beforeCreate钩子函数</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resolve injections before data/props 在数据/道具之前解决注入问题 //初始化 inject</span>
    <span class="token comment">// 初始化状态，props，methods，data，computed，watch</span>
    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// resolve provide after data/props  解决后提供数据/道具  provide 选项应该是一个对象或返回一个对象的函数。该对象包含可注入其子孙的属性，用于组件之间通信。</span>
    <span class="token comment">// 触发created钩子函数</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Vue 的$mount()为手动挂载，</span>
    <span class="token comment">// 在项目中可用于延时挂载（例如在挂载之前要进行一些其他操作、判断等），之后要手动挂载上。</span>
    <span class="token comment">// new Vue时，el和$mount并没有本质上的不同。</span>
    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//真实dom 或者是string</span>
<span class="token comment">//新的虚拟dom vonde</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$mount</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  el <span class="token operator">=</span> el <span class="token operator">&amp;&amp;</span> inBrowser <span class="token operator">?</span> <span class="token function">query</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//安装组件</span>
<span class="token keyword">function</span> <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token parameter">vm<span class="token punctuation">,</span> el<span class="token punctuation">,</span> hydrating</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>$el <span class="token operator">=</span> el<span class="token punctuation">;</span> <span class="token comment">//dom</span>
  <span class="token comment">//执行生命周期函数 beforeMount</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeMount'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> <span class="token function-variable function">updateComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//直接更新view试图</span>
    vm<span class="token punctuation">.</span><span class="token function">_update</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span><span class="token function">_render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hydrating<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span>
    vm<span class="token punctuation">,</span>  <span class="token comment">//vm vode</span>
    updateComponent<span class="token punctuation">,</span> <span class="token comment">//数据绑定完之后回调该函数。更新组件函数 更新 view试图</span>
    noop<span class="token punctuation">,</span> <span class="token comment">//回调函数</span>
    <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//参数</span>
    <span class="token boolean">true</span> <span class="token comment">//是否渲染过得观察者</span>
    <span class="token comment">/* isRenderWatcher */</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  hydrating <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">// manually mounted instance, call mounted on self</span>
  <span class="token comment">// mounted is called for render-created child components in its inserted hook</span>
  <span class="token comment">//手动挂载实例，调用挂载在self上</span>
  <span class="token comment">// 在插入的钩子中为呈现器创建的子组件调用// mount</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$vnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span>_isMounted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">//执行生命周期函数mounted</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'mounted'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> vm
<span class="token punctuation">}</span>
</code></pre></div><h1 id="双向数据绑定"><a href="#双向数据绑定" class="header-anchor">#</a> 双向数据绑定</h1> <p>vue实现数据双向绑定主要是：采<strong>用数据劫持结合发布者-订阅者模式</strong>的方式，通过 <code>Object.defineProperty()</code> 来劫持各个属性的setter，getter，在数据变动时发布消息给订阅者，触发相应监听回调。当把一个普通 Javascript 对象传给 Vue 实例来作为它的 data 选项时，Vue 将遍历它的属性，用 <code>Object.defineProperty()</code> 将它们转为 <code>getter/setter</code>。用户看不到 <code>getter/setter</code>，但是在内部它们让 Vue 追踪依赖，在属性被访问和修改时通知变化。</p> <p>vue的数据双向绑定 将MVVM作为数据绑定的入口，整合Observer，Compile和Watcher三者，通过Observer来监听自己的model的数据变化，通过Compile来解析编译模板指令（vue中是用来解析 <code>{{}}</code>），最终利用watcher搭起observer和Compile之间的通信桥梁，达到数据变化 —&gt;视图更新；视图交互变化（input）—&gt;数据model变更双向绑定效果。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>txt<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'txt'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> obj
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> newValue
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> newValue
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>txt <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">5/26/2022, 2:50:40 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/6.设计模式/pyqt.html" class="prev">
        /6.设计模式/pyqt.html
      </a></span> <span class="next"><a href="/6.设计模式/vue3.html">
        /6.设计模式/vue3.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.4e225d25.js" defer></script><script src="/assets/js/2.837ff8a6.js" defer></script><script src="/assets/js/28.51d22622.js" defer></script>
  </body>
</html>
